# 文件 Base64 转换工具 (File Base64 Converter)

## 一、背景说明

当前 CodeWave 平台不支持 `byte` 字节类型，也不支持二进制字节流的直接处理。为解决此限制，本依赖库提供“通过 URL 下载网络文件并转换为 Base64 字符串”的能力，便于在平台中进行后续传输或存储。

该库对应 Maven 制品为 `file-base64-converter`（`version`：`1.0.0`），定位为通用的文件 Base64 转换工具库，支持将文件 URL 批量转换为 Base64 编码字符串，并内置网络下载与编码转换逻辑。

## 二、核心功能

1. **网络文件下载**：基于 `HttpURLConnection` 以 `GET` 方式拉取远程文件内容。
2. **Base64 编码转换**：将下载得到的二进制内容编码为 Base64 字符串（使用 `Base64.getEncoder()`）。
3. **批量转换**：支持传入 URL 列表，按输入顺序逐个转换并返回结果列表。
4. **超时控制**：内置连接超时 `10` 秒、读取超时 `30` 秒，避免长时间阻塞。
5. **异常处理**：下载失败或转换异常时记录日志并返回 `null`（批量场景返回列表，失败项为 `null`），保证流程不崩溃。

## 三、配置说明

本依赖库为无状态、无全局配置设计：

- 不需要 `application.yml` 等全局配置；连接信息由入参 `fileUrl` / `fileUrls` 动态指定。
- 依赖库通过 Spring 环境自动扫描注入（无需额外手动装配）。

## 四、接口说明

### 1. 批量转换 (convertUrlListToBase64)

批量将网络文件 URL 列表转换为 Base64 字符串列表，保持输入顺序返回。

**入参**

| 字段名称 | 描述 | 类型 | 说明 |
| :--- | :--- | :--- | :--- |
| fileUrls | 文件 URL 地址列表 | List&lt;String&gt; | 可选：允许为 `null`，此时直接返回空列表<br>建议每个元素为完整 `http://` 或 `https://` 地址，例如：`https://example.com/a.png` |

**出参**

| 字段名称 | 描述 | 类型 | 说明 |
| :--- | :--- | :--- | :--- |
| result | Base64 字符串列表 | List&lt;String&gt; | 与输入列表顺序一致<br>若某个 URL 转换失败，对应位置返回 `null` |

### 2. 单文件转换 (convertUrlToBase64)

输入一个文件 URL，下载并返回该文件内容的 Base64 编码字符串。

**入参**

| 字段名称 | 描述 | 类型 | 说明 |
| :--- | :--- | :--- | :--- |
| fileUrl | 文件 URL 地址 | String | 必填：不能为空；若为 `null` 或空串直接返回 `null`<br>需为 `http://` 或 `https://` 开头的完整地址，例如：`https://example.com/a.png` |

**出参**

| 字段名称 | 描述 | 类型 | 说明 |
| :--- | :--- | :--- | :--- |
| result | Base64 字符串 | String | 转换成功返回 Base64 字符串（不包含 `data:` 前缀）<br>失败返回 `null` |

## 五、注意事项

1. 请确保传入的 URL 为可访问的 `http://` 或 `https://` 地址；本库基于 `HttpURLConnection` 实现，非 HTTP(S) 协议将导致转换失败并返回 `null`。
2. 仅当响应码为 `200`（`HttpURLConnection.HTTP_OK`）时才认为下载成功；否则会记录错误日志并返回 `null`。
3. URL 中如包含空格、中文等特殊字符，请先按 URL 规范进行编码（例如按 UTF-8 进行 URL 编码），避免 `new URL(fileUrl)` 解析失败。
4. 单文件转换在入参为 `null` 或空串时直接返回 `null`；批量转换在入参列表为 `null` 时返回空列表，列表内某个元素为空或下载失败时对应结果为 `null`。
5. 默认连接超时时间为 `10` 秒，读取超时时间为 `30` 秒；超时或其他异常会被捕获，记录日志后返回 `null`。
6. 转换过程会将文件完整读入内存后再进行 Base64 编码；大文件会带来较高内存消耗，建议用于图片、PDF 等中小型文件。
7. 本库不涉及 FTP 场景，因此不包含被动模式、目录切换、目录不存在处理、`FTP.BINARY_FILE_TYPE` 等相关配置；文件内容按 HTTP 输入流字节读取后直接进行 Base64 编码。